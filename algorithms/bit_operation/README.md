# 位运算

> 位运算就是基于整数的二进制表示进行的运算。由于计算机内部就是以二进制来存储数据，位运算是相当快的。

## 逻辑运算

1. AND
2. OR
3. XOR
4. NOT

补码：二进制下，正数和 0 的补码是其本身，正数对应负数的补码是正数按位取反后加一。

补码相当于把负数转换成同余的正数，减法也就变成了加法。

## 移位运算

- 左移：高位丢弃，低位补 0. 左移一位相当于乘以 2
- 右移：对于无符号数高位补 0，对于有符号数高位补符号数。右移一位相当于除以 2，注意无论是正数还是负数都向下取整，相当于 `n // 1`

## 优先级

> 位运算的优先级低于算术运算符（除了取反），而按位与、按位或及异或低于比较运算符，所以使用时需多加注意，在必要时添加括号。

Python 中，一部分 Operator precedence 如下：

`~x` > `+, -` > `<<, >>` > `&` > `^` > `|` > comparisons > `not` > `and` > `or`

## 技巧

1. 判断奇偶

通过和最后一位二进制数做 AND 1 或者 OR 0 比较

1. XOR

任何数和 0 进行 XOR 操作都会得到这个数本身，和 1 进行 XOR 操作会得到相反的二进制结果。

一个数和同一个数进行两（偶数）次 XOR 会得到它本身。

交换两个数：

```python
a = a^b
b = a^b
a = a^b
```

1. 2 的整数次幂 n 和 n-1 的二进制结果正好相反，做 AND 会得到 0，做 OR 或 XOR 会得到 n+n-1

1. 正负数转换

`~n + 1` 正数取反加 1（正数和 0 的补码是其本身，正数对应负数的补码是正数按位取反后加 1）；负数取反加 1 则变为其原码，即正数（其实和前面的逆过程是一样的，即负数的补码减 1 再取反）

1. 通过移位获取特定位的数值

1. -1 的二进制为全 1
